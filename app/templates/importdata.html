<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title></title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/navbar.css') }}" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}" />
    <link rel="stylesheet" href="" />
    <script src="{{ url_for('static', filename='js/navbar.js') }}" defer></script>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
</head>

<body>
    {% include 'navbar.html' %}
    <main class="content">
        <header class="content-header">
            <h1>Import Your Data</h1>
        </header>
        <section class="import-section">
            <h3>Select your Broker to Import Data</h3>
            <label for="broker-select" style="font-weight: 500; margin-right: 10px">Select Broker:</label>
            <select id="broker-select" name="broker"
                style="padding: 8px 16px; border-radius: 6px; border: 1px solid #ccc">
                <option value="" disabled selected>Select</option>
                <option value="zerodha">Zerodha</option>
                <option value="groww">Groww</option>
                <option value="angelone">AngelOne</option>
            </select>
        </section>
        <section class="upload-section" style="margin-top: 30px;">
            <h3> Upload your file </h3>
            <form action="{{ url_for('importdata') }}" method="post" enctype="multipart/form-data">
                <input type="file" name="datafile" accept="*/*" required
                    style="padding: 8px 16px; border-radius: 6px; border: 1px solid #ccc" required />
                <button type="submit"
                    style="padding: 8px 16px; border-radius: 6px; border: none; background-color: #4CAF50; color: white; cursor: pointer; margin-left: 10px;">
                    Upload
                </button>
            </form>
        </section>
        <!-- Instructions Section -->
<div id="instructions">
    <div id="zerodha-instructions" class="broker-instructions" style="display:none;">
        <h4>Zerodha Instructions</h4>
        <p>Download your tradebook from Zerodha Console → Reports → Tradebook → Export CSV.</p>
    </div>

    <div id="groww-instructions" class="broker-instructions" style="display:none;">
        <h4>Groww Instructions</h4>
        <p>Go to Groww Dashboard → Reports → All Transactions → Download CSV.</p>
    </div>

    <div id="angelone-instructions" class="broker-instructions" style="display:none;">
        <h4>AngelOne Instructions</h4>
        <p>Open AngelOne SmartAPI → Reports → Trade History → Export CSV file.</p>
    </div>
</div>
    </main>

    <script>
      (function () {
    const loginUrl = "{{ url_for('login') }}";
    const sessionEndpoint = "{{ url_for('session_status') }}";

    function enforceSession() {
        fetch(sessionEndpoint, { cache: 'no-store' })
            .then(r => r.ok ? r.json() : Promise.reject())
            .then(data => {
                if (!data.logged_in) {
                    window.location.replace(loginUrl);
                }
            })
            .catch(() => window.location.replace(loginUrl));
    }

    // Run on load and when user navigates via back button
    enforceSession();
    window.addEventListener('pageshow', (event) => {
        if (event.persisted) enforceSession();
    });

    // Logout button
    window.handleLogout = function() {
        fetch("{{ url_for('logout') }}", { method: 'GET', cache: 'no-store' })
            .finally(() => window.location.replace(loginUrl));
    };
})();

    </script>

</body>

</html>